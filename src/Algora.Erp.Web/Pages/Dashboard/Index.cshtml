@page "/Dashboard"
@model Algora.Erp.Web.Pages.Dashboard.IndexModel
@using Algora.Erp.Domain.Entities.Sales
@{
    ViewData["Title"] = "Dashboard";
}

<div class="flex flex-col md:flex-row md:justify-between md:items-center mb-6">
    <div>
        <h4 class="text-2xl font-bold text-gray-900 mb-1">Dashboard</h4>
        <p class="text-gray-500">Welcome back! Here's what's happening with your business today.</p>
    </div>
    <div class="flex items-center gap-3 mt-4 md:mt-0">
        <span class="text-gray-500 text-sm"><i class="bi bi-clock mr-1"></i>@DateTime.Now.ToString("dddd, MMMM dd, yyyy")</span>
        <button onclick="location.reload()" class="px-4 py-2 text-sm font-medium text-white bg-primary-600 rounded-lg hover:bg-primary-700 transition-colors">
            <i class="bi bi-arrow-clockwise mr-1"></i>Refresh
        </button>
    </div>
</div>

<!-- Main Stats Cards -->
<div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-4 mb-6">
    <div class="bg-white rounded-xl shadow-sm p-6">
        <div class="flex justify-between items-start">
            <div>
                <p class="text-sm text-gray-500 mb-1">Total Revenue</p>
                <h3 class="text-2xl font-bold text-gray-900">@Model.TotalRevenue.ToString("C")</h3>
                <p class="text-sm text-gray-500 mt-1">From @Model.TotalOrders orders</p>
            </div>
            <div class="p-3 bg-primary-100 rounded-lg">
                <i class="bi bi-currency-dollar text-2xl text-primary-600"></i>
            </div>
        </div>
    </div>
    <div class="bg-white rounded-xl shadow-sm p-6">
        <div class="flex justify-between items-start">
            <div>
                <p class="text-sm text-gray-500 mb-1">Customers</p>
                <h3 class="text-2xl font-bold text-gray-900">@Model.TotalCustomers</h3>
                <p class="text-sm text-gray-500 mt-1">@Model.TotalSuppliers suppliers</p>
            </div>
            <div class="p-3 bg-emerald-100 rounded-lg">
                <i class="bi bi-people text-2xl text-emerald-600"></i>
            </div>
        </div>
    </div>
    <div class="bg-white rounded-xl shadow-sm p-6">
        <div class="flex justify-between items-start">
            <div>
                <p class="text-sm text-gray-500 mb-1">Products</p>
                <h3 class="text-2xl font-bold text-gray-900">@Model.TotalProducts</h3>
                @if (Model.LowStockProducts > 0)
                {
                    <p class="text-sm text-red-600 mt-1"><i class="bi bi-exclamation-triangle mr-1"></i>@Model.LowStockProducts low stock</p>
                }
                else
                {
                    <p class="text-sm text-emerald-600 mt-1"><i class="bi bi-check-circle mr-1"></i>Stock OK</p>
                }
            </div>
            <div class="p-3 bg-amber-100 rounded-lg">
                <i class="bi bi-box text-2xl text-amber-600"></i>
            </div>
        </div>
    </div>
    <div class="bg-white rounded-xl shadow-sm p-6">
        <div class="flex justify-between items-start">
            <div>
                <p class="text-sm text-gray-500 mb-1">Employees</p>
                <h3 class="text-2xl font-bold text-gray-900">@Model.TotalEmployees</h3>
                <p class="text-sm text-gray-500 mt-1">Active employees</p>
            </div>
            <div class="p-3 bg-blue-100 rounded-lg">
                <i class="bi bi-person-badge text-2xl text-blue-600"></i>
            </div>
        </div>
    </div>
</div>

<!-- Module Stats -->
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
    <div class="bg-white rounded-xl shadow-sm p-5 border-l-4 border-primary-500">
        <div class="flex items-center">
            <div class="p-3 bg-primary-100 rounded-lg mr-4">
                <i class="bi bi-kanban text-xl text-primary-600"></i>
            </div>
            <div>
                <h5 class="text-xl font-bold text-gray-900">@Model.ActiveProjects</h5>
                <p class="text-sm text-gray-500">Active Projects</p>
            </div>
        </div>
    </div>
    <div class="bg-white rounded-xl shadow-sm p-5 border-l-4 border-amber-500">
        <div class="flex items-center">
            <div class="p-3 bg-amber-100 rounded-lg mr-4">
                <i class="bi bi-cart-check text-xl text-amber-600"></i>
            </div>
            <div>
                <h5 class="text-xl font-bold text-gray-900">@Model.PendingPurchaseOrders</h5>
                <p class="text-sm text-gray-500">Pending POs</p>
            </div>
        </div>
    </div>
    <div class="bg-white rounded-xl shadow-sm p-5 border-l-4 border-emerald-500">
        <div class="flex items-center">
            <div class="p-3 bg-emerald-100 rounded-lg mr-4">
                <i class="bi bi-gear text-xl text-emerald-600"></i>
            </div>
            <div>
                <h5 class="text-xl font-bold text-gray-900">@Model.OpenWorkOrders</h5>
                <p class="text-sm text-gray-500">Open Work Orders</p>
            </div>
        </div>
    </div>
    <div class="bg-white rounded-xl shadow-sm p-5 border-l-4 border-blue-500">
        <div class="flex items-center">
            <div class="p-3 bg-blue-100 rounded-lg mr-4">
                <i class="bi bi-clock-history text-xl text-blue-600"></i>
            </div>
            <div>
                <h5 class="text-xl font-bold text-gray-900">@Model.TotalBillableHours.ToString("N1")</h5>
                <p class="text-sm text-gray-500">Billable Hours</p>
            </div>
        </div>
    </div>
</div>

<div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
    <!-- Recent Orders -->
    <div class="bg-white rounded-xl shadow-sm">
        <div class="flex justify-between items-center px-6 py-4 border-b border-gray-200">
            <h6 class="font-semibold text-gray-800"><i class="bi bi-bag-check mr-2"></i>Recent Sales Orders</h6>
            <a href="/Sales/Orders" class="text-sm text-primary-600 hover:text-primary-700 font-medium">View All</a>
        </div>
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Order #</th>
                        <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Customer</th>
                        <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Amount</th>
                        <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Status</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-200">
                    @if (Model.RecentOrders.Any())
                    {
                        @foreach (var order in Model.RecentOrders)
                        {
                            var statusClass = order.Status switch
                            {
                                SalesOrderStatus.Draft => "bg-gray-100 text-gray-800",
                                SalesOrderStatus.Confirmed => "bg-primary-100 text-primary-800",
                                SalesOrderStatus.PartiallyShipped => "bg-blue-100 text-blue-800",
                                SalesOrderStatus.Shipped => "bg-emerald-100 text-emerald-800",
                                SalesOrderStatus.Delivered => "bg-emerald-100 text-emerald-800",
                                SalesOrderStatus.Cancelled => "bg-red-100 text-red-800",
                                _ => "bg-gray-100 text-gray-800"
                            };
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4">
                                    <a href="/Sales/Orders/@order.Id" class="text-primary-600 hover:text-primary-700 font-medium">@order.OrderNumber</a>
                                </td>
                                <td class="px-6 py-4 text-gray-700">@(order.Customer?.Name ?? "-")</td>
                                <td class="px-6 py-4 font-semibold text-gray-900">@order.TotalAmount.ToString("C")</td>
                                <td class="px-6 py-4">
                                    <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium @statusClass">@order.Status</span>
                                </td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="4" class="px-6 py-8 text-center text-gray-500">No orders yet</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>

    <!-- Active Projects -->
    <div class="bg-white rounded-xl shadow-sm">
        <div class="flex justify-between items-center px-6 py-4 border-b border-gray-200">
            <h6 class="font-semibold text-gray-800"><i class="bi bi-kanban mr-2"></i>Active Projects</h6>
            <a href="/Projects" class="text-sm text-primary-600 hover:text-primary-700 font-medium">View All</a>
        </div>
        <div class="overflow-x-auto">
            <table class="w-full">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Project</th>
                        <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Customer</th>
                        <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Progress</th>
                        <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">Manager</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-gray-200">
                    @if (Model.ActiveProjectsList.Any())
                    {
                        @foreach (var project in Model.ActiveProjectsList)
                        {
                            var progressClass = project.Progress >= 75 ? "bg-emerald-500" : project.Progress >= 50 ? "bg-blue-500" : project.Progress >= 25 ? "bg-amber-500" : "bg-gray-400";
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4">
                                    <a href="/Projects/@project.Id" class="text-primary-600 hover:text-primary-700 font-medium">@project.Name</a>
                                    <p class="text-sm text-gray-500">@project.ProjectCode</p>
                                </td>
                                <td class="px-6 py-4 text-gray-700">@(project.Customer?.Name ?? "-")</td>
                                <td class="px-6 py-4">
                                    <div class="w-20 h-2 bg-gray-200 rounded-full">
                                        <div class="h-2 @progressClass rounded-full" style="width: @project.Progress%"></div>
                                    </div>
                                    <span class="text-xs text-gray-500">@project.Progress%</span>
                                </td>
                                <td class="px-6 py-4 text-gray-700">
                                    @if (project.ProjectManager != null)
                                    {
                                        @($"{project.ProjectManager.FirstName} {project.ProjectManager.LastName.Substring(0, 1)}.")
                                    }
                                    else
                                    {
                                        <span class="text-gray-400">-</span>
                                    }
                                </td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="4" class="px-6 py-8 text-center text-gray-500">No active projects</td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Quick Actions -->
    <div class="bg-white rounded-xl shadow-sm">
        <div class="px-6 py-4 border-b border-gray-200">
            <h6 class="font-semibold text-gray-800"><i class="bi bi-lightning mr-2"></i>Quick Actions</h6>
        </div>
        <div class="p-6 space-y-3">
            <a href="/Sales/Customers" class="flex items-center w-full px-4 py-3 text-primary-600 border border-primary-200 rounded-lg hover:bg-primary-50 transition-colors">
                <i class="bi bi-person-plus mr-3"></i>Add Customer
            </a>
            <a href="/Inventory/Products" class="flex items-center w-full px-4 py-3 text-primary-600 border border-primary-200 rounded-lg hover:bg-primary-50 transition-colors">
                <i class="bi bi-box-seam mr-3"></i>Add Product
            </a>
            <a href="/Projects" class="flex items-center w-full px-4 py-3 text-primary-600 border border-primary-200 rounded-lg hover:bg-primary-50 transition-colors">
                <i class="bi bi-kanban mr-3"></i>Create Project
            </a>
            <a href="/Procurement/Suppliers" class="flex items-center w-full px-4 py-3 text-primary-600 border border-primary-200 rounded-lg hover:bg-primary-50 transition-colors">
                <i class="bi bi-truck mr-3"></i>Add Supplier
            </a>
            <a href="/HR/Employees" class="flex items-center w-full px-4 py-3 text-primary-600 border border-primary-200 rounded-lg hover:bg-primary-50 transition-colors">
                <i class="bi bi-person-badge mr-3"></i>Add Employee
            </a>
        </div>
    </div>

    <!-- Alerts & Notifications -->
    <div class="bg-white rounded-xl shadow-sm">
        <div class="px-6 py-4 border-b border-gray-200">
            <h6 class="font-semibold text-gray-800"><i class="bi bi-bell mr-2"></i>Alerts</h6>
        </div>
        <div class="divide-y divide-gray-200">
            @if (Model.LowStockProducts > 0)
            {
                <div class="flex items-center gap-3 px-6 py-4">
                    <div class="p-2 bg-red-100 rounded-full">
                        <i class="bi bi-exclamation-triangle text-red-600"></i>
                    </div>
                    <div>
                        <p class="font-medium text-gray-900">Low Stock Alert</p>
                        <p class="text-sm text-gray-500">@Model.LowStockProducts products below threshold</p>
                    </div>
                </div>
            }
            @if (Model.PendingLeaveRequests > 0)
            {
                <div class="flex items-center gap-3 px-6 py-4">
                    <div class="p-2 bg-amber-100 rounded-full">
                        <i class="bi bi-clock text-amber-600"></i>
                    </div>
                    <div>
                        <p class="font-medium text-gray-900">Pending Approvals</p>
                        <p class="text-sm text-gray-500">@Model.PendingLeaveRequests leave requests waiting</p>
                    </div>
                </div>
            }
            @if (Model.UpcomingMilestones > 0)
            {
                <div class="flex items-center gap-3 px-6 py-4">
                    <div class="p-2 bg-blue-100 rounded-full">
                        <i class="bi bi-flag text-blue-600"></i>
                    </div>
                    <div>
                        <p class="font-medium text-gray-900">Upcoming Milestones</p>
                        <p class="text-sm text-gray-500">@Model.UpcomingMilestones due this week</p>
                    </div>
                </div>
            }
            @if (Model.PendingPayrollRuns > 0)
            {
                <div class="flex items-center gap-3 px-6 py-4">
                    <div class="p-2 bg-primary-100 rounded-full">
                        <i class="bi bi-cash-stack text-primary-600"></i>
                    </div>
                    <div>
                        <p class="font-medium text-gray-900">Pending Payroll</p>
                        <p class="text-sm text-gray-500">@Model.PendingPayrollRuns payroll runs to process</p>
                    </div>
                </div>
            }
            @if (Model.LowStockProducts == 0 && Model.PendingLeaveRequests == 0 && Model.UpcomingMilestones == 0 && Model.PendingPayrollRuns == 0)
            {
                <div class="px-6 py-8 text-center">
                    <i class="bi bi-check-circle text-emerald-500 text-4xl"></i>
                    <p class="text-gray-500 mt-2">All caught up!</p>
                </div>
            }
        </div>
    </div>

    <!-- Module Summary -->
    <div class="bg-white rounded-xl shadow-sm">
        <div class="px-6 py-4 border-b border-gray-200">
            <h6 class="font-semibold text-gray-800"><i class="bi bi-grid mr-2"></i>Module Summary</h6>
        </div>
        <div class="divide-y divide-gray-200">
            <a href="/HR/Employees" class="flex justify-between items-center px-6 py-4 hover:bg-gray-50 transition-colors">
                <span class="text-gray-700"><i class="bi bi-people mr-2"></i>HR & Employees</span>
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-primary-100 text-primary-800">@Model.TotalEmployees</span>
            </a>
            <a href="/Finance/Accounts" class="flex justify-between items-center px-6 py-4 hover:bg-gray-50 transition-colors">
                <span class="text-gray-700"><i class="bi bi-bank mr-2"></i>Finance</span>
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-emerald-100 text-emerald-800">@Model.TotalRevenue.ToString("C0")</span>
            </a>
            <a href="/Inventory/Products" class="flex justify-between items-center px-6 py-4 hover:bg-gray-50 transition-colors">
                <span class="text-gray-700"><i class="bi bi-box mr-2"></i>Inventory</span>
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-amber-100 text-amber-800">@Model.TotalProducts</span>
            </a>
            <a href="/Sales/Customers" class="flex justify-between items-center px-6 py-4 hover:bg-gray-50 transition-colors">
                <span class="text-gray-700"><i class="bi bi-bag mr-2"></i>Sales & CRM</span>
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">@Model.TotalCustomers</span>
            </a>
            <a href="/Manufacturing/WorkOrders" class="flex justify-between items-center px-6 py-4 hover:bg-gray-50 transition-colors">
                <span class="text-gray-700"><i class="bi bi-gear mr-2"></i>Manufacturing</span>
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">@Model.OpenWorkOrders WO</span>
            </a>
        </div>
    </div>
</div>
