@page
@model Algora.Erp.Web.Pages.Admin.Settings.IndexModel
@{
    ViewData["Title"] = "Settings";
}

<div class="space-y-6">
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <div>
            <h1 class="text-2xl font-bold text-gray-900">System Settings</h1>
            <nav class="flex mt-1" aria-label="Breadcrumb">
                <ol class="inline-flex items-center space-x-1 text-sm text-gray-500">
                    <li><a href="/" class="hover:text-primary-600">Dashboard</a></li>
                    <li><span class="mx-1">/</span></li>
                    <li><a href="/Admin" class="hover:text-primary-600">Admin</a></li>
                    <li><span class="mx-1">/</span></li>
                    <li class="text-gray-900 font-medium">Settings</li>
                </ol>
            </nav>
        </div>
    </div>

    @if (TempData["SuccessMessage"] != null)
    {
        <div class="flex items-center p-4 text-emerald-800 rounded-lg bg-emerald-50" role="alert">
            <i class="bi bi-check-circle mr-2"></i>@TempData["SuccessMessage"]
            <button type="button" class="ml-auto -mx-1.5 -my-1.5 bg-emerald-50 text-emerald-500 rounded-lg p-1.5 hover:bg-emerald-200 inline-flex items-center justify-center h-8 w-8" data-dismiss-target="[role='alert']" aria-label="Close">
                <i class="bi bi-x-lg"></i>
            </button>
        </div>
    }

    @if (TempData["ErrorMessage"] != null)
    {
        <div class="flex items-center p-4 text-red-800 rounded-lg bg-red-50" role="alert">
            <i class="bi bi-exclamation-circle mr-2"></i>@TempData["ErrorMessage"]
            <button type="button" class="ml-auto -mx-1.5 -my-1.5 bg-red-50 text-red-500 rounded-lg p-1.5 hover:bg-red-200 inline-flex items-center justify-center h-8 w-8" data-dismiss-target="[role='alert']" aria-label="Close">
                <i class="bi bi-x-lg"></i>
            </button>
        </div>
    }

    <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
        <!-- Settings Navigation -->
        <div class="lg:col-span-1">
            <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                <nav class="flex flex-col" id="settingsTabs" role="tablist">
                    <button class="settings-tab-btn flex items-center px-4 py-3 text-left border-b border-gray-200 transition-colors bg-primary-50 text-primary-700 font-medium" data-tab-target="general" type="button" role="tab" aria-selected="true">
                        <i class="bi bi-building mr-3"></i>General & Company
                    </button>
                    <button class="settings-tab-btn flex items-center px-4 py-3 text-left text-gray-700 border-b border-gray-200 hover:bg-gray-50 transition-colors" data-tab-target="currency" type="button" role="tab" aria-selected="false">
                        <i class="bi bi-currency-exchange mr-3"></i>Currency
                    </button>
                    <button class="settings-tab-btn flex items-center px-4 py-3 text-left text-gray-700 border-b border-gray-200 hover:bg-gray-50 transition-colors" data-tab-target="tax" type="button" role="tab" aria-selected="false">
                        <i class="bi bi-percent mr-3"></i>Tax Settings
                    </button>
                    <button class="settings-tab-btn flex items-center px-4 py-3 text-left text-gray-700 border-b border-gray-200 hover:bg-gray-50 transition-colors" data-tab-target="invoice" type="button" role="tab" aria-selected="false">
                        <i class="bi bi-receipt mr-3"></i>Invoice Settings
                    </button>
                    <button class="settings-tab-btn flex items-center px-4 py-3 text-left text-gray-700 border-b border-gray-200 hover:bg-gray-50 transition-colors" data-tab-target="email" type="button" role="tab" aria-selected="false">
                        <i class="bi bi-envelope mr-3"></i>Email (SMTP)
                    </button>
                    <button class="settings-tab-btn flex items-center px-4 py-3 text-left text-gray-700 border-b border-gray-200 hover:bg-gray-50 transition-colors" data-tab-target="security" type="button" role="tab" aria-selected="false">
                        <i class="bi bi-shield-lock mr-3"></i>Security
                    </button>
                    <button class="settings-tab-btn flex items-center px-4 py-3 text-left text-gray-700 hover:bg-gray-50 transition-colors" data-tab-target="about" type="button" role="tab" aria-selected="false">
                        <i class="bi bi-info-circle mr-3"></i>About
                    </button>
                </nav>
            </div>
        </div>

        <!-- Settings Content -->
        <div class="lg:col-span-3">
            <div id="settingsTabContent">
                <!-- General & Company Settings -->
                <div class="settings-tab-panel" id="general-panel" role="tabpanel">
                    <div class="bg-white rounded-xl shadow-sm">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h5 class="text-lg font-semibold text-gray-900"><i class="bi bi-building mr-2"></i>General & Company Settings</h5>
                        </div>
                        <div class="p-6">
                            <form method="post" asp-page-handler="General">
                                <h6 class="text-sm font-medium text-gray-500 mb-3">Company Information</h6>
                                <div class="grid grid-cols-12 gap-4 mb-6">
                                    <div class="col-span-12 md:col-span-6">
                                        <label class="block mb-2 text-sm font-medium text-gray-900">Company Name <span class="text-red-500">*</span></label>
                                        <input type="text" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5" asp-for="Settings.CompanyName" required />
                                    </div>
                                    <div class="col-span-12 md:col-span-6">
                                        <label class="block mb-2 text-sm font-medium text-gray-900">Company Tagline</label>
                                        <input type="text" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5" asp-for="Settings.CompanyTagline" placeholder="Your business tagline" />
                                    </div>
                                    <div class="col-span-12 md:col-span-6">
                                        <label class="block mb-2 text-sm font-medium text-gray-900">Website</label>
                                        <input type="url" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5" asp-for="Settings.CompanyWebsite" placeholder="https://www.example.com" />
                                    </div>
                                    <div class="col-span-12 md:col-span-6">
                                        <label class="block mb-2 text-sm font-medium text-gray-900">Email</label>
                                        <input type="email" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5" asp-for="Settings.CompanyEmail" placeholder="contact@example.com" />
                                    </div>
                                    <div class="col-span-12 md:col-span-6">
                                        <label class="block mb-2 text-sm font-medium text-gray-900">Phone</label>
                                        <input type="tel" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5" asp-for="Settings.CompanyPhone" placeholder="+91 9876543210" />
                                    </div>
                                </div>

                                <h6 class="text-sm font-medium text-gray-500 mb-3">Address</h6>
                                <div class="grid grid-cols-12 gap-4 mb-6">
                                    <div class="col-span-12 md:col-span-6">
                                        <label class="block mb-2 text-sm font-medium text-gray-900">Address Line 1</label>
                                        <input type="text" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5" asp-for="Settings.AddressLine1" />
                                    </div>
                                    <div class="col-span-12 md:col-span-6">
                                        <label class="block mb-2 text-sm font-medium text-gray-900">Address Line 2</label>
                                        <input type="text" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5" asp-for="Settings.AddressLine2" />
                                    </div>
                                    <div class="col-span-12 md:col-span-4">
                                        <label class="block mb-2 text-sm font-medium text-gray-900">City</label>
                                        <input type="text" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5" asp-for="Settings.City" />
                                    </div>
                                    <div class="col-span-12 md:col-span-4">
                                        <label class="block mb-2 text-sm font-medium text-gray-900">State/Province</label>
                                        <input type="text" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5" asp-for="Settings.State" />
                                    </div>
                                    <div class="col-span-12 md:col-span-4">
                                        <label class="block mb-2 text-sm font-medium text-gray-900">Postal Code</label>
                                        <input type="text" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5" asp-for="Settings.PostalCode" />
                                    </div>
                                    <div class="col-span-12 md:col-span-6">
                                        <label class="block mb-2 text-sm font-medium text-gray-900">Country</label>
                                        <select class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5" asp-for="Settings.Country" id="countrySelect">
                                            @foreach (var country in Model.CountryOptions)
                                            {
                                                var isSelected = Model.Settings.Country == country.Name;
                                                if (isSelected)
                                                {
                                                    <option value="@country.Name" data-code="@country.Code" selected>@country.Name</option>
                                                }
                                                else
                                                {
                                                    <option value="@country.Name" data-code="@country.Code">@country.Name</option>
                                                }
                                            }
                                        </select>
                                        <input type="hidden" asp-for="Settings.CountryCode" id="countryCodeInput" />
                                    </div>
                                </div>

                                <h6 class="text-sm font-medium text-gray-500 mb-3">Regional Settings</h6>
                                <div class="grid grid-cols-12 gap-4">
                                    <div class="col-span-12 md:col-span-4">
                                        <label class="block mb-2 text-sm font-medium text-gray-900">Time Zone</label>
                                        <select class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5" asp-for="Settings.TimeZone">
                                            @foreach (var tz in Model.TimezoneOptions)
                                            {
                                                var isSelected = Model.Settings.TimeZone == tz.Id;
                                                if (isSelected)
                                                {
                                                    <option value="@tz.Id" selected>@tz.DisplayName</option>
                                                }
                                                else
                                                {
                                                    <option value="@tz.Id">@tz.DisplayName</option>
                                                }
                                            }
                                        </select>
                                    </div>
                                    <div class="col-span-12 md:col-span-4">
                                        <label class="block mb-2 text-sm font-medium text-gray-900">Date Format</label>
                                        <select class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5" asp-for="Settings.DateFormat">
                                            @foreach (var df in Model.DateFormatOptions)
                                            {
                                                var isSelected = Model.Settings.DateFormat == df.Format;
                                                if (isSelected)
                                                {
                                                    <option value="@df.Format" selected>@df.Example</option>
                                                }
                                                else
                                                {
                                                    <option value="@df.Format">@df.Example</option>
                                                }
                                            }
                                        </select>
                                    </div>
                                    <div class="col-span-12 md:col-span-4">
                                        <label class="block mb-2 text-sm font-medium text-gray-900">Language</label>
                                        <select class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5" asp-for="Settings.Language">
                                            @foreach (var lang in Model.LanguageOptions)
                                            {
                                                var isSelected = Model.Settings.Language == lang.Code;
                                                if (isSelected)
                                                {
                                                    <option value="@lang.Code" selected>@lang.Name</option>
                                                }
                                                else
                                                {
                                                    <option value="@lang.Code">@lang.Name</option>
                                                }
                                            }
                                        </select>
                                    </div>
                                </div>

                                <div class="mt-6">
                                    <button type="submit" class="text-white bg-primary-600 hover:bg-primary-700 focus:ring-4 focus:ring-primary-300 font-medium rounded-lg text-sm px-5 py-2.5">
                                        <i class="bi bi-check-lg mr-2"></i>Save General Settings
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Currency Settings -->
                <div class="settings-tab-panel hidden" id="currency-panel" role="tabpanel">
                    <div class="bg-white rounded-xl shadow-sm">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h5 class="text-lg font-semibold text-gray-900"><i class="bi bi-currency-exchange mr-2"></i>Currency Settings</h5>
                        </div>
                        <div class="p-6">
                            <form method="post" asp-page-handler="Currency">
                                <div class="grid grid-cols-12 gap-4">
                                    <div class="col-span-12 md:col-span-6">
                                        <label class="block mb-2 text-sm font-medium text-gray-900">Currency <span class="text-red-500">*</span></label>
                                        <select class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3" asp-for="Settings.Currency" id="currencySelect">
                                            @foreach (var curr in Model.CurrencyOptions)
                                            {
                                                var isSelected = Model.Settings.Currency == curr.Code;
                                                if (isSelected)
                                                {
                                                    <option value="@curr.Code" data-symbol="@curr.Symbol" data-name="@curr.Name" selected>@curr.Code - @curr.Symbol @curr.Name</option>
                                                }
                                                else
                                                {
                                                    <option value="@curr.Code" data-symbol="@curr.Symbol" data-name="@curr.Name">@curr.Code - @curr.Symbol @curr.Name</option>
                                                }
                                            }
                                        </select>
                                    </div>
                                    <div class="col-span-12 md:col-span-3">
                                        <label class="block mb-2 text-sm font-medium text-gray-900">Symbol Preview</label>
                                        <div class="flex items-center h-[46px]">
                                            <span id="currencySymbolPreview" class="inline-flex items-center px-4 py-2 text-2xl font-medium text-white bg-primary-600 rounded-lg">@Model.Settings.CurrencySymbol</span>
                                        </div>
                                    </div>
                                    <div class="col-span-12 md:col-span-3">
                                        <label class="block mb-2 text-sm font-medium text-gray-900">Decimal Places</label>
                                        <select class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-3" asp-for="Settings.CurrencyDecimalPlaces">
                                            @{
                                                var dp = Model.Settings.CurrencyDecimalPlaces;
                                            }
                                            @if (dp == 0)
                                            {
                                                <option value="0" selected>0 (e.g., 1,234)</option>
                                            }
                                            else
                                            {
                                                <option value="0">0 (e.g., 1,234)</option>
                                            }
                                            @if (dp == 2)
                                            {
                                                <option value="2" selected>2 (e.g., 1,234.56)</option>
                                            }
                                            else
                                            {
                                                <option value="2">2 (e.g., 1,234.56)</option>
                                            }
                                            @if (dp == 3)
                                            {
                                                <option value="3" selected>3 (e.g., 1,234.567)</option>
                                            }
                                            else
                                            {
                                                <option value="3">3 (e.g., 1,234.567)</option>
                                            }
                                        </select>
                                    </div>
                                </div>

                                <div class="flex items-center p-4 mt-4 text-blue-800 rounded-lg bg-blue-50" id="currencyInfoAlert">
                                    <i class="bi bi-info-circle mr-2"></i>
                                    <strong>Selected Currency:</strong> <span id="currencyInfoSymbol" class="ml-1">@Model.Settings.CurrencySymbol</span> <span id="currencyInfoName">@Model.Settings.CurrencyName</span> (<span id="currencyInfoCode">@Model.Settings.Currency</span>)
                                    <br /><small class="ml-1">Currency changes will affect all new invoices and financial documents.</small>
                                </div>

                                <div class="mt-6">
                                    <button type="submit" class="text-white bg-primary-600 hover:bg-primary-700 focus:ring-4 focus:ring-primary-300 font-medium rounded-lg text-sm px-5 py-2.5">
                                        <i class="bi bi-check-lg mr-2"></i>Save Currency Settings
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Tax Settings -->
                <div class="settings-tab-panel hidden" id="tax-panel" role="tabpanel">
                    <div class="bg-white rounded-xl shadow-sm">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h5 class="text-lg font-semibold text-gray-900"><i class="bi bi-percent mr-2"></i>Tax Settings</h5>
                        </div>
                        <div class="p-6">
                            <form method="post" asp-page-handler="Tax">
                                <div class="grid grid-cols-12 gap-4">
                                    <div class="col-span-12 md:col-span-6">
                                        <label class="block mb-2 text-sm font-medium text-gray-900">Tax ID Label</label>
                                        <input type="text" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5" asp-for="Settings.TaxIdLabel" placeholder="e.g., GSTIN, VAT, TIN" />
                                        <p class="mt-1 text-xs text-gray-500">The label shown on invoices (e.g., GSTIN for India, VAT for EU)</p>
                                    </div>
                                    <div class="col-span-12 md:col-span-6">
                                        <label class="block mb-2 text-sm font-medium text-gray-900">@(Model.Settings.TaxIdLabel ?? "Tax ID")</label>
                                        <input type="text" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5" asp-for="Settings.TaxId" placeholder="Enter your tax identification number" />
                                    </div>
                                    <div class="col-span-12 md:col-span-6">
                                        <label class="block mb-2 text-sm font-medium text-gray-900">PAN Number</label>
                                        <input type="text" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5" asp-for="Settings.PanNumber" placeholder="AAAPA1234A" maxlength="10" />
                                        <p class="mt-1 text-xs text-gray-500">Required for India GST registration</p>
                                    </div>
                                    <div class="col-span-12 md:col-span-6">
                                        <div class="flex items-center mt-6">
                                            <input type="checkbox" class="w-4 h-4 text-primary-600 bg-gray-100 border-gray-300 rounded focus:ring-primary-500" asp-for="Settings.IsGstRegistered" />
                                            <label class="ml-2 text-sm font-medium text-gray-900" asp-for="Settings.IsGstRegistered">
                                                <strong>GST Registered</strong>
                                            </label>
                                        </div>
                                        <p class="mt-1 text-xs text-gray-500 ml-6">Enable GST calculations (CGST/SGST for intra-state, IGST for inter-state)</p>
                                    </div>
                                </div>

                                <div class="mt-6">
                                    <button type="submit" class="text-white bg-primary-600 hover:bg-primary-700 focus:ring-4 focus:ring-primary-300 font-medium rounded-lg text-sm px-5 py-2.5">
                                        <i class="bi bi-check-lg mr-2"></i>Save Tax Settings
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Invoice Settings -->
                <div class="settings-tab-panel hidden" id="invoice-panel" role="tabpanel">
                    <div class="bg-white rounded-xl shadow-sm">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h5 class="text-lg font-semibold text-gray-900"><i class="bi bi-receipt mr-2"></i>Invoice Settings</h5>
                        </div>
                        <div class="p-6">
                            <form method="post" asp-page-handler="Invoice">
                                <h6 class="text-sm font-medium text-gray-500 mb-3">Document Prefixes</h6>
                                <div class="grid grid-cols-12 gap-4 mb-6">
                                    <div class="col-span-12 md:col-span-4">
                                        <label class="block mb-2 text-sm font-medium text-gray-900">Invoice Prefix</label>
                                        <input type="text" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5" asp-for="Settings.InvoicePrefix" maxlength="10" />
                                        <p class="mt-1 text-xs text-gray-500">e.g., INV -> INV-2026-0001</p>
                                    </div>
                                    <div class="col-span-12 md:col-span-4">
                                        <label class="block mb-2 text-sm font-medium text-gray-900">Quotation Prefix</label>
                                        <input type="text" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5" asp-for="Settings.QuotationPrefix" maxlength="10" />
                                    </div>
                                    <div class="col-span-12 md:col-span-4">
                                        <label class="block mb-2 text-sm font-medium text-gray-900">Sales Order Prefix</label>
                                        <input type="text" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5" asp-for="Settings.SalesOrderPrefix" maxlength="10" />
                                    </div>
                                    <div class="col-span-12 md:col-span-4">
                                        <label class="block mb-2 text-sm font-medium text-gray-900">Purchase Order Prefix</label>
                                        <input type="text" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5" asp-for="Settings.PurchaseOrderPrefix" maxlength="10" />
                                    </div>
                                    <div class="col-span-12 md:col-span-4">
                                        <label class="block mb-2 text-sm font-medium text-gray-900">Delivery Challan Prefix</label>
                                        <input type="text" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5" asp-for="Settings.DeliveryChallanPrefix" maxlength="10" />
                                    </div>
                                    <div class="col-span-12 md:col-span-4">
                                        <label class="block mb-2 text-sm font-medium text-gray-900">Goods Receipt Prefix</label>
                                        <input type="text" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5" asp-for="Settings.GoodsReceiptPrefix" maxlength="10" />
                                    </div>
                                </div>

                                <h6 class="text-sm font-medium text-gray-500 mb-3">Payment Terms</h6>
                                <div class="grid grid-cols-12 gap-4 mb-6">
                                    <div class="col-span-12 md:col-span-4">
                                        <label class="block mb-2 text-sm font-medium text-gray-900">Default Payment Term (Days)</label>
                                        <input type="number" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5" asp-for="Settings.DefaultPaymentTermDays" min="0" max="365" />
                                    </div>
                                    <div class="col-span-12 md:col-span-8">
                                        <label class="block mb-2 text-sm font-medium text-gray-900">Payment Terms Text</label>
                                        <input type="text" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5" asp-for="Settings.DefaultPaymentTerms" placeholder="e.g., Net 30, Due on Receipt" />
                                    </div>
                                </div>

                                <h6 class="text-sm font-medium text-gray-500 mb-3">Invoice PDF Settings</h6>
                                <div class="grid grid-cols-12 gap-4 mb-6">
                                    <div class="col-span-12">
                                        <label class="block mb-2 text-sm font-medium text-gray-900">Invoice Header Text</label>
                                        <input type="text" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5" asp-for="Settings.InvoiceHeaderText" placeholder="Tax Invoice" />
                                    </div>
                                    <div class="col-span-12">
                                        <label class="block mb-2 text-sm font-medium text-gray-900">Invoice Footer Text</label>
                                        <input type="text" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5" asp-for="Settings.InvoiceFooterText" placeholder="Thank you for your business!" />
                                    </div>
                                    <div class="col-span-12">
                                        <label class="block mb-2 text-sm font-medium text-gray-900">Terms and Conditions</label>
                                        <textarea class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5" asp-for="Settings.InvoiceTermsText" rows="3" placeholder="Enter default invoice terms and conditions..."></textarea>
                                    </div>
                                    <div class="col-span-12 md:col-span-6">
                                        <div class="flex items-center">
                                            <input type="checkbox" class="w-4 h-4 text-primary-600 bg-gray-100 border-gray-300 rounded focus:ring-primary-500" asp-for="Settings.ShowGstBreakdown" />
                                            <label class="ml-2 text-sm font-medium text-gray-900" asp-for="Settings.ShowGstBreakdown">
                                                Show GST Breakdown (CGST/SGST/IGST)
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-span-12 md:col-span-6">
                                        <div class="flex items-center">
                                            <input type="checkbox" class="w-4 h-4 text-primary-600 bg-gray-100 border-gray-300 rounded focus:ring-primary-500" asp-for="Settings.ShowHsnCode" />
                                            <label class="ml-2 text-sm font-medium text-gray-900" asp-for="Settings.ShowHsnCode">
                                                Show HSN/SAC Code on Invoice
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <div class="mt-6">
                                    <button type="submit" class="text-white bg-primary-600 hover:bg-primary-700 focus:ring-4 focus:ring-primary-300 font-medium rounded-lg text-sm px-5 py-2.5">
                                        <i class="bi bi-check-lg mr-2"></i>Save Invoice Settings
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Email Settings -->
                <div class="settings-tab-panel hidden" id="email-panel" role="tabpanel">
                    <div class="bg-white rounded-xl shadow-sm">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h5 class="text-lg font-semibold text-gray-900"><i class="bi bi-envelope mr-2"></i>Email (SMTP) Settings</h5>
                        </div>
                        <div class="p-6">
                            <form method="post" asp-page-handler="Email">
                                <div class="grid grid-cols-12 gap-4">
                                    <div class="col-span-12 md:col-span-8">
                                        <label class="block mb-2 text-sm font-medium text-gray-900">SMTP Host</label>
                                        <input type="text" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5" asp-for="Settings.SmtpHost" placeholder="smtp.gmail.com" />
                                    </div>
                                    <div class="col-span-12 md:col-span-4">
                                        <label class="block mb-2 text-sm font-medium text-gray-900">SMTP Port</label>
                                        <input type="number" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5" asp-for="Settings.SmtpPort" />
                                    </div>
                                    <div class="col-span-12 md:col-span-6">
                                        <label class="block mb-2 text-sm font-medium text-gray-900">SMTP Username</label>
                                        <input type="text" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5" asp-for="Settings.SmtpUsername" placeholder="your-email@gmail.com" />
                                    </div>
                                    <div class="col-span-12 md:col-span-6">
                                        <label class="block mb-2 text-sm font-medium text-gray-900">SMTP Password</label>
                                        <input type="password" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5" asp-for="Settings.SmtpPassword" placeholder="Enter to change password" />
                                        <p class="mt-1 text-xs text-gray-500">Leave blank to keep existing password</p>
                                    </div>
                                    <div class="col-span-12 md:col-span-6">
                                        <label class="block mb-2 text-sm font-medium text-gray-900">From Email Address</label>
                                        <input type="email" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5" asp-for="Settings.EmailFromAddress" placeholder="noreply@yourcompany.com" />
                                    </div>
                                    <div class="col-span-12 md:col-span-6">
                                        <label class="block mb-2 text-sm font-medium text-gray-900">From Name</label>
                                        <input type="text" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5" asp-for="Settings.EmailFromName" placeholder="Your Company Name" />
                                    </div>
                                    <div class="col-span-12">
                                        <div class="flex items-center">
                                            <input type="checkbox" class="w-4 h-4 text-primary-600 bg-gray-100 border-gray-300 rounded focus:ring-primary-500" asp-for="Settings.SmtpEnableSsl" />
                                            <label class="ml-2 text-sm font-medium text-gray-900" asp-for="Settings.SmtpEnableSsl">Enable SSL/TLS</label>
                                        </div>
                                    </div>
                                </div>
                                <div class="mt-6 flex gap-2">
                                    <button type="submit" class="text-white bg-primary-600 hover:bg-primary-700 focus:ring-4 focus:ring-primary-300 font-medium rounded-lg text-sm px-5 py-2.5">
                                        <i class="bi bi-check-lg mr-2"></i>Save Email Settings
                                    </button>
                                    <button type="submit" asp-page-handler="TestEmail" class="text-gray-900 bg-white border border-gray-300 hover:bg-gray-100 focus:ring-4 focus:ring-gray-200 font-medium rounded-lg text-sm px-5 py-2.5">
                                        <i class="bi bi-send mr-2"></i>Send Test Email
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Security Settings -->
                <div class="settings-tab-panel hidden" id="security-panel" role="tabpanel">
                    <div class="bg-white rounded-xl shadow-sm">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h5 class="text-lg font-semibold text-gray-900"><i class="bi bi-shield-lock mr-2"></i>Security Settings</h5>
                        </div>
                        <div class="p-6">
                            <form method="post" asp-page-handler="Security">
                                <h6 class="text-sm font-medium text-gray-500 mb-3">Password Policy</h6>
                                <div class="grid grid-cols-12 gap-4 mb-6">
                                    <div class="col-span-12 md:col-span-4">
                                        <label class="block mb-2 text-sm font-medium text-gray-900">Minimum Password Length</label>
                                        <input type="number" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5" asp-for="Settings.PasswordMinLength" min="6" max="32" />
                                    </div>
                                    <div class="col-span-12 md:col-span-8">
                                        <label class="block mb-2 text-sm font-medium text-gray-900">Password Requirements</label>
                                        <div class="flex flex-wrap gap-4">
                                            <div class="flex items-center">
                                                <input type="checkbox" class="w-4 h-4 text-primary-600 bg-gray-100 border-gray-300 rounded focus:ring-primary-500" asp-for="Settings.PasswordRequireUppercase" />
                                                <label class="ml-2 text-sm text-gray-900">Uppercase (A-Z)</label>
                                            </div>
                                            <div class="flex items-center">
                                                <input type="checkbox" class="w-4 h-4 text-primary-600 bg-gray-100 border-gray-300 rounded focus:ring-primary-500" asp-for="Settings.PasswordRequireLowercase" />
                                                <label class="ml-2 text-sm text-gray-900">Lowercase (a-z)</label>
                                            </div>
                                            <div class="flex items-center">
                                                <input type="checkbox" class="w-4 h-4 text-primary-600 bg-gray-100 border-gray-300 rounded focus:ring-primary-500" asp-for="Settings.PasswordRequireDigit" />
                                                <label class="ml-2 text-sm text-gray-900">Digit (0-9)</label>
                                            </div>
                                            <div class="flex items-center">
                                                <input type="checkbox" class="w-4 h-4 text-primary-600 bg-gray-100 border-gray-300 rounded focus:ring-primary-500" asp-for="Settings.PasswordRequireSpecialChar" />
                                                <label class="ml-2 text-sm text-gray-900">Special (!&#64;#$)</label>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <h6 class="text-sm font-medium text-gray-500 mb-3">Session and Lockout</h6>
                                <div class="grid grid-cols-12 gap-4 mb-6">
                                    <div class="col-span-12 md:col-span-4">
                                        <label class="block mb-2 text-sm font-medium text-gray-900">Session Timeout (minutes)</label>
                                        <input type="number" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5" asp-for="Settings.SessionTimeoutMinutes" min="5" max="480" />
                                    </div>
                                    <div class="col-span-12 md:col-span-4">
                                        <label class="block mb-2 text-sm font-medium text-gray-900">Max Login Attempts</label>
                                        <input type="number" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5" asp-for="Settings.MaxLoginAttempts" min="3" max="10" />
                                    </div>
                                    <div class="col-span-12 md:col-span-4">
                                        <label class="block mb-2 text-sm font-medium text-gray-900">Lockout Duration (minutes)</label>
                                        <input type="number" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full p-2.5" asp-for="Settings.LockoutDurationMinutes" min="5" max="60" />
                                    </div>
                                </div>

                                <h6 class="text-sm font-medium text-gray-500 mb-3">Two-Factor Authentication</h6>
                                <div class="flex items-center mb-3">
                                    <input type="checkbox" class="w-4 h-4 text-primary-600 bg-gray-100 border-gray-300 rounded focus:ring-primary-500" asp-for="Settings.EnableTwoFactor" />
                                    <label class="ml-2 text-sm font-medium text-gray-900" asp-for="Settings.EnableTwoFactor">
                                        <strong>Enable Two-Factor Authentication</strong>
                                    </label>
                                </div>
                                <p class="text-xs text-gray-500 ml-6 mb-6">Users will be required to set up 2FA on next login</p>

                                <div class="mt-6">
                                    <button type="submit" class="text-white bg-primary-600 hover:bg-primary-700 focus:ring-4 focus:ring-primary-300 font-medium rounded-lg text-sm px-5 py-2.5">
                                        <i class="bi bi-check-lg mr-2"></i>Save Security Settings
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- About -->
                <div class="settings-tab-panel hidden" id="about-panel" role="tabpanel">
                    <div class="bg-white rounded-xl shadow-sm">
                        <div class="px-6 py-4 border-b border-gray-200">
                            <h5 class="text-lg font-semibold text-gray-900"><i class="bi bi-info-circle mr-2"></i>About</h5>
                        </div>
                        <div class="p-6">
                            <div class="text-center py-6">
                                <h2 class="text-2xl font-bold text-primary-600 mb-1">Algora ERP</h2>
                                <p class="text-gray-500">Enterprise Resource Planning System</p>
                                <span class="inline-flex items-center px-3 py-1 mt-4 text-sm font-medium text-white bg-primary-600 rounded-full">Version 1.0.0</span>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-6">
                                <div class="bg-gray-50 rounded-lg p-4">
                                    <h6 class="font-medium text-gray-900 mb-3"><i class="bi bi-cpu mr-2"></i>System Information</h6>
                                    <table class="w-full text-sm">
                                        <tr>
                                            <td class="text-gray-500 py-1">.NET Version</td>
                                            <td class="text-gray-900 py-1">8.0</td>
                                        </tr>
                                        <tr>
                                            <td class="text-gray-500 py-1">Database</td>
                                            <td class="text-gray-900 py-1">SQL Server</td>
                                        </tr>
                                        <tr>
                                            <td class="text-gray-500 py-1">Server OS</td>
                                            <td class="text-gray-900 py-1">@Environment.OSVersion</td>
                                        </tr>
                                    </table>
                                </div>
                                <div class="bg-gray-50 rounded-lg p-4">
                                    <h6 class="font-medium text-gray-900 mb-3"><i class="bi bi-gear mr-2"></i>Current Settings</h6>
                                    <table class="w-full text-sm">
                                        <tr>
                                            <td class="text-gray-500 py-1">Currency</td>
                                            <td class="text-gray-900 py-1">@Model.Settings.CurrencySymbol @Model.Settings.Currency</td>
                                        </tr>
                                        <tr>
                                            <td class="text-gray-500 py-1">Country</td>
                                            <td class="text-gray-900 py-1">@Model.Settings.Country</td>
                                        </tr>
                                        <tr>
                                            <td class="text-gray-500 py-1">Time Zone</td>
                                            <td class="text-gray-900 py-1">@Model.Settings.TimeZone</td>
                                        </tr>
                                    </table>
                                </div>
                            </div>

                            <hr class="my-6 border-gray-200" />

                            <div class="text-center text-gray-500">
                                <p class="mb-1">2024-2026 Algora. All rights reserved.</p>
                                <p class="text-sm">
                                    <a href="#" class="text-gray-500 hover:text-primary-600">Documentation</a> |
                                    <a href="#" class="text-gray-500 hover:text-primary-600">Support</a> |
                                    <a href="#" class="text-gray-500 hover:text-primary-600">Privacy Policy</a>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Settings Tab Navigation
        document.addEventListener('DOMContentLoaded', function() {
            const tabButtons = document.querySelectorAll('.settings-tab-btn');
            const tabPanels = document.querySelectorAll('.settings-tab-panel');

            function switchTab(targetId) {
                // Hide all panels
                tabPanels.forEach(panel => {
                    panel.classList.add('hidden');
                });

                // Reset all button styles
                tabButtons.forEach(btn => {
                    btn.classList.remove('bg-primary-50', 'text-primary-700', 'font-medium');
                    btn.classList.add('text-gray-700', 'hover:bg-gray-50');
                    btn.setAttribute('aria-selected', 'false');
                });

                // Show target panel
                const targetPanel = document.getElementById(targetId + '-panel');
                if (targetPanel) {
                    targetPanel.classList.remove('hidden');
                }

                // Activate clicked button
                const activeBtn = document.querySelector(`[data-tab-target="${targetId}"]`);
                if (activeBtn) {
                    activeBtn.classList.remove('text-gray-700', 'hover:bg-gray-50');
                    activeBtn.classList.add('bg-primary-50', 'text-primary-700', 'font-medium');
                    activeBtn.setAttribute('aria-selected', 'true');
                }

                // Save to localStorage for persistence
                localStorage.setItem('settingsActiveTab', targetId);
            }

            // Add click handlers to all tab buttons
            tabButtons.forEach(btn => {
                btn.addEventListener('click', function() {
                    const targetId = this.getAttribute('data-tab-target');
                    switchTab(targetId);
                });
            });

            // Restore last active tab from localStorage
            const savedTab = localStorage.getItem('settingsActiveTab');
            if (savedTab) {
                switchTab(savedTab);
            }
        });

        // Update country code when country changes
        document.getElementById('countrySelect')?.addEventListener('change', function() {
            const selectedOption = this.options[this.selectedIndex];
            document.getElementById('countryCodeInput').value = selectedOption.dataset.code;
        });

        // Update currency display when currency changes
        document.getElementById('currencySelect')?.addEventListener('change', function() {
            const selectedOption = this.options[this.selectedIndex];
            const symbol = selectedOption.dataset.symbol;
            const name = selectedOption.dataset.name;
            const code = selectedOption.value;

            // Update the symbol preview badge
            document.getElementById('currencySymbolPreview').textContent = symbol;

            // Update the info alert
            document.getElementById('currencyInfoSymbol').textContent = symbol;
            document.getElementById('currencyInfoName').textContent = name;
            document.getElementById('currencyInfoCode').textContent = code;
        });
    </script>
}
