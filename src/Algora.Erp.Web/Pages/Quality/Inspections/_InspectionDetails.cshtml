@model Algora.Erp.Domain.Entities.Quality.QualityInspection
@using Algora.Erp.Domain.Entities.Quality

@{
    var statusClass = Model.Status switch
    {
        InspectionStatus.Pending => "bg-gray-100 text-gray-800",
        InspectionStatus.InProgress => "bg-blue-100 text-blue-800",
        InspectionStatus.Completed => "bg-primary-100 text-primary-800",
        InspectionStatus.Approved => "bg-emerald-100 text-emerald-800",
        InspectionStatus.Rejected => "bg-red-100 text-red-800",
        InspectionStatus.Cancelled => "bg-gray-700 text-white",
        _ => "bg-gray-100 text-gray-800"
    };

    var resultClass = Model.OverallResult switch
    {
        QCOverallResult.Pending => "bg-gray-100 text-gray-800",
        QCOverallResult.Pass => "bg-emerald-100 text-emerald-800",
        QCOverallResult.Fail => "bg-red-100 text-red-800",
        QCOverallResult.PartialPass => "bg-amber-100 text-amber-800",
        QCOverallResult.ConditionalPass => "bg-blue-100 text-blue-800",
        _ => "bg-gray-100 text-gray-800"
    };
}

<div class="grid grid-cols-12 gap-4">
    <!-- Header Info -->
    <div class="col-span-12">
        <div class="flex justify-between items-start">
            <div>
                <h5 class="text-lg font-semibold text-gray-900 mb-1">@Model.InspectionNumber</h5>
                <p class="text-gray-500 mb-0">@Model.InspectionType Inspection</p>
            </div>
            <div class="text-right">
                <span class="text-xs font-medium px-2.5 py-0.5 rounded-full @statusClass mr-2">@Model.Status</span>
                <span class="text-xs font-medium px-2.5 py-0.5 rounded-full @resultClass">@Model.OverallResult</span>
            </div>
        </div>
    </div>

    <!-- Inspection Details -->
    <div class="md:col-span-6 col-span-12">
        <div class="bg-white rounded-lg shadow-md h-full">
            <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
                <h6 class="text-sm font-medium text-gray-900 mb-0">Inspection Information</h6>
            </div>
            <div class="p-6">
                <table class="w-full text-sm">
                    <tr>
                        <td class="text-gray-500 py-1" style="width: 40%;">Inspection Date:</td>
                        <td class="font-medium text-gray-900 py-1">@Model.InspectionDate.ToString("dd MMM yyyy")</td>
                    </tr>
                    <tr>
                        <td class="text-gray-500 py-1">Type:</td>
                        <td class="font-medium text-gray-900 py-1">@Model.InspectionType</td>
                    </tr>
                    <tr>
                        <td class="text-gray-500 py-1">Source Document:</td>
                        <td class="font-medium text-gray-900 py-1">
                            @Model.SourceDocumentType: @(Model.SourceDocumentNumber ?? "-")
                        </td>
                    </tr>
                    @if (Model.InspectedAt.HasValue)
                    {
                        <tr>
                            <td class="text-gray-500 py-1">Inspected At:</td>
                            <td class="font-medium text-gray-900 py-1">@Model.InspectedAt.Value.ToString("dd MMM yyyy HH:mm")</td>
                        </tr>
                    }
                    @if (!string.IsNullOrEmpty(Model.InspectorName))
                    {
                        <tr>
                            <td class="text-gray-500 py-1">Inspector:</td>
                            <td class="font-medium text-gray-900 py-1">@Model.InspectorName</td>
                        </tr>
                    }
                    @if (Model.ApprovedAt.HasValue)
                    {
                        <tr>
                            <td class="text-gray-500 py-1">Approved At:</td>
                            <td class="font-medium text-gray-900 py-1">@Model.ApprovedAt.Value.ToString("dd MMM yyyy HH:mm")</td>
                        </tr>
                    }
                </table>
            </div>
        </div>
    </div>

    <!-- Product & Quantities -->
    <div class="md:col-span-6 col-span-12">
        <div class="bg-white rounded-lg shadow-md h-full">
            <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
                <h6 class="text-sm font-medium text-gray-900 mb-0">Product & Quantities</h6>
            </div>
            <div class="p-6">
                <table class="w-full text-sm">
                    @if (Model.Product != null)
                    {
                        <tr>
                            <td class="text-gray-500 py-1" style="width: 40%;">Product:</td>
                            <td class="py-1">
                                <div class="font-medium text-gray-900">@Model.Product.Name</div>
                                <small class="text-gray-500">@Model.Product.Sku</small>
                            </td>
                        </tr>
                    }
                    @if (Model.Warehouse != null)
                    {
                        <tr>
                            <td class="text-gray-500 py-1">Warehouse:</td>
                            <td class="font-medium text-gray-900 py-1">@Model.Warehouse.Name</td>
                        </tr>
                    }
                    <tr>
                        <td class="text-gray-500 py-1">Total Quantity:</td>
                        <td class="font-medium text-gray-900 py-1">@Model.TotalQuantity.ToString("N2")</td>
                    </tr>
                    <tr>
                        <td class="text-gray-500 py-1">Sample Size:</td>
                        <td class="font-medium text-gray-900 py-1">@Model.SampleSize.ToString("N2")</td>
                    </tr>
                    <tr>
                        <td class="text-gray-500 py-1">Inspected:</td>
                        <td class="font-medium text-gray-900 py-1">@Model.InspectedQuantity.ToString("N2")</td>
                    </tr>
                </table>
            </div>
        </div>
    </div>

    <!-- Quantity Summary -->
    <div class="col-span-12">
        <div class="grid grid-cols-12 gap-3">
            <div class="md:col-span-4 col-span-12">
                <div class="bg-gray-50 rounded-lg border-0 p-4 text-center">
                    <p class="text-gray-500 mb-1 text-sm">Total Inspected</p>
                    <h5 class="text-lg font-semibold text-gray-900 mb-0">@Model.InspectedQuantity.ToString("N2")</h5>
                </div>
            </div>
            <div class="md:col-span-4 col-span-12">
                <div class="bg-emerald-50 rounded-lg border-0 p-4 text-center">
                    <p class="text-gray-500 mb-1 text-sm">Passed</p>
                    <h5 class="text-lg font-semibold text-emerald-600 mb-0">@Model.PassedQuantity.ToString("N2")</h5>
                </div>
            </div>
            <div class="md:col-span-4 col-span-12">
                <div class="bg-red-50 rounded-lg border-0 p-4 text-center">
                    <p class="text-gray-500 mb-1 text-sm">Failed</p>
                    <h5 class="text-lg font-semibold text-red-600 mb-0">@Model.FailedQuantity.ToString("N2")</h5>
                </div>
            </div>
        </div>
    </div>

    <!-- QC Parameters -->
    @if (Model.Parameters.Any())
    {
        <div class="col-span-12">
            <div class="bg-white rounded-lg shadow-md">
                <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
                    <h6 class="text-sm font-medium text-gray-900 mb-0">Quality Check Parameters</h6>
                </div>
                <div class="p-0">
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm text-left text-gray-500">
                            <thead class="text-xs text-gray-700 uppercase bg-gray-50">
                                <tr>
                                    <th scope="col" class="px-4 py-3">#</th>
                                    <th scope="col" class="px-4 py-3">Parameter</th>
                                    <th scope="col" class="px-4 py-3">Expected</th>
                                    <th scope="col" class="px-4 py-3">Min/Max</th>
                                    <th scope="col" class="px-4 py-3">Actual</th>
                                    <th scope="col" class="px-4 py-3">Result</th>
                                    <th scope="col" class="px-4 py-3">Remarks</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var param in Model.Parameters.OrderBy(p => p.SequenceNumber))
                                {
                                    var paramResultClass = param.Result switch
                                    {
                                        QCParameterResult.Pending => "bg-gray-100 text-gray-800",
                                        QCParameterResult.Pass => "bg-emerald-100 text-emerald-800",
                                        QCParameterResult.Fail => "bg-red-100 text-red-800",
                                        QCParameterResult.Warning => "bg-amber-100 text-amber-800",
                                        QCParameterResult.NotApplicable => "bg-gray-50 text-gray-600",
                                        _ => "bg-gray-100 text-gray-800"
                                    };

                                    <tr class="bg-white border-b hover:bg-gray-50">
                                        <td class="px-4 py-3">@param.SequenceNumber</td>
                                        <td class="px-4 py-3">
                                            <div class="font-medium text-gray-900">@param.ParameterName</div>
                                            @if (!string.IsNullOrEmpty(param.ParameterCode))
                                            {
                                                <small class="text-gray-500">@param.ParameterCode</small>
                                            }
                                        </td>
                                        <td class="px-4 py-3">@(param.ExpectedValue ?? "-")</td>
                                        <td class="px-4 py-3">
                                            @if (param.MinValue.HasValue || param.MaxValue.HasValue)
                                            {
                                                <text>@(param.MinValue?.ToString("N2") ?? "-") / @(param.MaxValue?.ToString("N2") ?? "-")</text>
                                            }
                                            else
                                            {
                                                <text>-</text>
                                            }
                                        </td>
                                        <td class="px-4 py-3 font-medium text-gray-900">
                                            @(param.ActualValue ?? (param.MeasuredValue?.ToString("N2") ?? "-"))
                                        </td>
                                        <td class="px-4 py-3">
                                            <span class="text-xs font-medium px-2.5 py-0.5 rounded-full @paramResultClass">@param.Result</span>
                                        </td>
                                        <td class="px-4 py-3">@(param.Remarks ?? "-")</td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    }

    <!-- Result Remarks -->
    @if (!string.IsNullOrEmpty(Model.ResultRemarks))
    {
        <div class="col-span-12">
            <div class="bg-white rounded-lg shadow-md">
                <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
                    <h6 class="text-sm font-medium text-gray-900 mb-0">Result Remarks</h6>
                </div>
                <div class="p-6">
                    <p class="text-gray-700 mb-0">@Model.ResultRemarks</p>
                </div>
            </div>
        </div>
    }

    <!-- Notes -->
    @if (!string.IsNullOrEmpty(Model.Notes))
    {
        <div class="col-span-12">
            <div class="bg-white rounded-lg shadow-md">
                <div class="px-6 py-4 border-b border-gray-200 bg-gray-50">
                    <h6 class="text-sm font-medium text-gray-900 mb-0">Notes</h6>
                </div>
                <div class="p-6">
                    <p class="text-gray-700 mb-0">@Model.Notes</p>
                </div>
            </div>
        </div>
    }
</div>

<div class="flex items-center p-4 border-t border-gray-200 rounded-b gap-2 mt-4 px-0 pb-0">
    @if (Model.Status == InspectionStatus.Pending || Model.Status == InspectionStatus.InProgress)
    {
        <button type="button" class="text-primary-600 border border-primary-600 hover:bg-primary-50 focus:ring-4 focus:ring-primary-300 font-medium rounded-lg text-sm px-5 py-2.5" onclick="editInspection('@Model.Id')" data-modal-hide="detailsModal">
            <i class="bi bi-pencil mr-2"></i>Edit / Record Results
        </button>
    }
    @if (Model.Status == InspectionStatus.Completed)
    {
        <button type="button" class="text-white bg-emerald-600 hover:bg-emerald-700 focus:ring-4 focus:ring-emerald-300 font-medium rounded-lg text-sm px-5 py-2.5" onclick="approveInspection('@Model.Id')" data-modal-hide="detailsModal">
            <i class="bi bi-check-circle mr-2"></i>Approve
        </button>
    }
    <button type="button" class="text-gray-900 bg-white border border-gray-300 hover:bg-gray-100 focus:ring-4 focus:ring-gray-200 font-medium rounded-lg text-sm px-5 py-2.5" data-modal-hide="detailsModal">Close</button>
</div>
