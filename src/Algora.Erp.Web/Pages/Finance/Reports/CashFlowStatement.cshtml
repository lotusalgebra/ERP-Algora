@page
@model Algora.Erp.Web.Pages.Finance.Reports.CashFlowStatementModel
@using Algora.Erp.Application.Common.Interfaces
@{
    ViewData["Title"] = "Cash Flow Statement";
}

<div class="space-y-6">
    <!-- Page Header -->
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <div>
            <h1 class="text-2xl font-bold text-gray-900">Cash Flow Statement</h1>
            <nav class="flex mt-1" aria-label="Breadcrumb">
                <ol class="inline-flex items-center space-x-1 md:space-x-3 text-sm">
                    <li><a href="/" class="text-gray-500 hover:text-indigo-600">Dashboard</a></li>
                    <li class="flex items-center"><span class="mx-2 text-gray-400">/</span><a href="/Finance" class="text-gray-500 hover:text-indigo-600">Finance</a></li>
                    <li class="flex items-center"><span class="mx-2 text-gray-400">/</span><a href="/Finance/Reports" class="text-gray-500 hover:text-indigo-600">Reports</a></li>
                    <li class="flex items-center"><span class="mx-2 text-gray-400">/</span><span class="text-gray-700">Cash Flow Statement</span></li>
                </ol>
            </nav>
        </div>
        <div class="flex gap-2">
            <a href="?handler=ExportPdf&StartDate=@(Model.StartDate?.ToString("yyyy-MM-dd"))&EndDate=@(Model.EndDate?.ToString("yyyy-MM-dd"))"
               class="inline-flex items-center px-4 py-2 border border-red-300 text-red-700 bg-white rounded-lg hover:bg-red-50 text-sm font-medium transition-colors">
                <i class="bi bi-file-pdf mr-2"></i>Export PDF
            </a>
            <a href="?handler=ExportCsv&StartDate=@(Model.StartDate?.ToString("yyyy-MM-dd"))&EndDate=@(Model.EndDate?.ToString("yyyy-MM-dd"))"
               class="inline-flex items-center px-4 py-2 border border-green-300 text-green-700 bg-white rounded-lg hover:bg-green-50 text-sm font-medium transition-colors">
                <i class="bi bi-file-excel mr-2"></i>Export CSV
            </a>
        </div>
    </div>

    <!-- Date Range Filter -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200">
        <div class="p-4 sm:p-6">
            <form method="get" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 items-end">
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">Start Date</label>
                    <input type="date" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" name="StartDate" value="@(Model.StartDate?.ToString("yyyy-MM-dd"))">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-1">End Date</label>
                    <input type="date" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500" name="EndDate" value="@(Model.EndDate?.ToString("yyyy-MM-dd"))">
                </div>
                <div>
                    <button type="submit" class="w-full inline-flex items-center justify-center px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 text-sm font-medium transition-colors">
                        <i class="bi bi-search mr-2"></i>Generate Report
                    </button>
                </div>
                <div class="flex justify-end">
                    <div class="inline-flex rounded-lg shadow-sm" role="group">
                        <a href="?StartDate=@(new DateTime(DateTime.Today.Year, DateTime.Today.Month, 1).ToString("yyyy-MM-dd"))&EndDate=@(DateTime.Today.ToString("yyyy-MM-dd"))"
                           class="px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-l-lg hover:bg-gray-50 hover:text-indigo-600">MTD</a>
                        <a href="?StartDate=@(new DateTime(DateTime.Today.Year, (DateTime.Today.Month-1)/3*3+1, 1).ToString("yyyy-MM-dd"))&EndDate=@(DateTime.Today.ToString("yyyy-MM-dd"))"
                           class="px-3 py-2 text-sm font-medium text-gray-700 bg-white border-t border-b border-gray-300 hover:bg-gray-50 hover:text-indigo-600">QTD</a>
                        <a href="?StartDate=@(new DateTime(DateTime.Today.Year, 1, 1).ToString("yyyy-MM-dd"))&EndDate=@(DateTime.Today.ToString("yyyy-MM-dd"))"
                           class="px-3 py-2 text-sm font-medium text-gray-700 bg-white border border-gray-300 rounded-r-lg hover:bg-gray-50 hover:text-indigo-600">YTD</a>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Key Metrics Cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4">
        <!-- Operating Cash Flow -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-5">
            <div class="flex justify-between items-start">
                <div>
                    <p class="text-sm font-medium text-gray-500 mb-1">Operating Cash Flow</p>
                    <p class="text-2xl font-bold @(Model.Report.NetCashFromOperating >= 0 ? "text-green-600" : "text-red-600")">
                        @Model.Report.NetCashFromOperating.ToString("C0")
                    </p>
                    <p class="text-xs text-gray-500 mt-1">From operations</p>
                </div>
                <div class="p-2.5 bg-indigo-100 rounded-lg">
                    <i class="bi bi-gear text-indigo-600 text-xl"></i>
                </div>
            </div>
        </div>

        <!-- Free Cash Flow -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-5">
            <div class="flex justify-between items-start">
                <div>
                    <p class="text-sm font-medium text-gray-500 mb-1">Free Cash Flow</p>
                    <p class="text-2xl font-bold @(Model.Report.FreeCashFlow >= 0 ? "text-green-600" : "text-red-600")">
                        @Model.Report.FreeCashFlow.ToString("C0")
                    </p>
                    <p class="text-xs text-gray-500 mt-1">Available for distribution</p>
                </div>
                <div class="p-2.5 bg-green-100 rounded-lg">
                    <i class="bi bi-cash-coin text-green-600 text-xl"></i>
                </div>
            </div>
        </div>

        <!-- Net Change in Cash -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-5">
            <div class="flex justify-between items-start">
                <div>
                    <p class="text-sm font-medium text-gray-500 mb-1">Net Change in Cash</p>
                    <p class="text-2xl font-bold @(Model.Report.NetChangeInCash >= 0 ? "text-green-600" : "text-red-600")">
                        @Model.Report.NetChangeInCash.ToString("C0")
                    </p>
                    <p class="text-xs text-gray-500 mt-1">Period change</p>
                </div>
                <div class="p-2.5 bg-cyan-100 rounded-lg">
                    <i class="bi bi-graph-up-arrow text-cyan-600 text-xl"></i>
                </div>
            </div>
        </div>

        <!-- Ending Cash Balance -->
        <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-5">
            <div class="flex justify-between items-start">
                <div>
                    <p class="text-sm font-medium text-gray-500 mb-1">Ending Cash Balance</p>
                    <p class="text-2xl font-bold text-gray-900">@Model.Report.EndingCashBalance.ToString("C0")</p>
                    <p class="text-xs mt-1">
                        @if (Model.Report.IsBalanced)
                        {
                            <span class="text-green-600"><i class="bi bi-check-circle mr-1"></i>Balanced</span>
                        }
                        else
                        {
                            <span class="text-red-600"><i class="bi bi-exclamation-circle mr-1"></i>Imbalanced</span>
                        }
                    </p>
                </div>
                <div class="p-2.5 bg-amber-100 rounded-lg">
                    <i class="bi bi-wallet2 text-amber-600 text-xl"></i>
                </div>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Cash Flow Statement -->
        <div class="lg:col-span-2">
            <div class="bg-white rounded-xl shadow-sm border border-gray-200">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h2 class="text-lg font-semibold text-gray-900 flex items-center">
                        <i class="bi bi-file-earmark-spreadsheet mr-2 text-indigo-600"></i>
                        Cash Flow Statement
                        <span class="text-sm font-normal text-gray-500 ml-2">
                            @Model.Report.DateRange.StartDate.ToString("MMM dd, yyyy") - @Model.Report.DateRange.EndDate.ToString("MMM dd, yyyy")
                        </span>
                    </h2>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full">
                        <!-- Operating Activities -->
                        <thead class="bg-indigo-50">
                            <tr>
                                <th colspan="2" class="px-6 py-3 text-left text-sm font-semibold text-indigo-800">
                                    <i class="bi bi-gear mr-2"></i>CASH FLOWS FROM OPERATING ACTIVITIES
                                </th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-100">
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-3 text-sm text-gray-700">Net Income</td>
                                <td class="px-6 py-3 text-sm font-medium text-right">@Model.Report.NetIncome.ToString("C2")</td>
                            </tr>
                            @if (Model.Report.OperatingAdjustments.Any())
                            {
                                <tr class="bg-gray-50">
                                    <td colspan="2" class="px-6 py-2 text-sm text-gray-500 italic">Adjustments to reconcile net income:</td>
                                </tr>
                                @foreach (var item in Model.Report.OperatingAdjustments)
                                {
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-3 text-sm text-gray-700 pl-10">@item.Description</td>
                                        <td class="px-6 py-3 text-sm font-medium text-right @(item.Amount >= 0 ? "text-green-600" : "text-red-600")">
                                            @item.Amount.ToString("C2")
                                        </td>
                                    </tr>
                                }
                            }
                            @if (Model.Report.WorkingCapitalChanges.Any())
                            {
                                <tr class="bg-gray-50">
                                    <td colspan="2" class="px-6 py-2 text-sm text-gray-500 italic">Changes in operating assets and liabilities:</td>
                                </tr>
                                @foreach (var item in Model.Report.WorkingCapitalChanges)
                                {
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-3 text-sm text-gray-700 pl-10">@item.Description</td>
                                        <td class="px-6 py-3 text-sm font-medium text-right @(item.Amount >= 0 ? "text-green-600" : "text-red-600")">
                                            @item.Amount.ToString("C2")
                                        </td>
                                    </tr>
                                }
                            }
                            <tr class="bg-indigo-100">
                                <td class="px-6 py-3 text-sm font-bold text-gray-900">Net Cash from Operating Activities</td>
                                <td class="px-6 py-3 text-sm font-bold text-right @(Model.Report.NetCashFromOperating >= 0 ? "text-green-600" : "text-red-600")">
                                    @Model.Report.NetCashFromOperating.ToString("C2")
                                </td>
                            </tr>
                        </tbody>

                        <!-- Investing Activities -->
                        <thead class="bg-cyan-50">
                            <tr>
                                <th colspan="2" class="px-6 py-3 text-left text-sm font-semibold text-cyan-800">
                                    <i class="bi bi-building mr-2"></i>CASH FLOWS FROM INVESTING ACTIVITIES
                                </th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-100">
                            @if (Model.Report.InvestingActivities.Any())
                            {
                                @foreach (var item in Model.Report.InvestingActivities)
                                {
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-3 text-sm text-gray-700">@item.Description</td>
                                        <td class="px-6 py-3 text-sm font-medium text-right @(item.Amount >= 0 ? "text-green-600" : "text-red-600")">
                                            @item.Amount.ToString("C2")
                                        </td>
                                    </tr>
                                }
                            }
                            else
                            {
                                <tr>
                                    <td class="px-6 py-3 text-sm text-gray-400 italic">(No investing activities)</td>
                                    <td class="px-6 py-3 text-sm text-gray-400 text-right">$0.00</td>
                                </tr>
                            }
                            <tr class="bg-cyan-100">
                                <td class="px-6 py-3 text-sm font-bold text-gray-900">Net Cash from Investing Activities</td>
                                <td class="px-6 py-3 text-sm font-bold text-right @(Model.Report.NetCashFromInvesting >= 0 ? "text-green-600" : "text-red-600")">
                                    @Model.Report.NetCashFromInvesting.ToString("C2")
                                </td>
                            </tr>
                        </tbody>

                        <!-- Financing Activities -->
                        <thead class="bg-amber-50">
                            <tr>
                                <th colspan="2" class="px-6 py-3 text-left text-sm font-semibold text-amber-800">
                                    <i class="bi bi-bank mr-2"></i>CASH FLOWS FROM FINANCING ACTIVITIES
                                </th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-100">
                            @if (Model.Report.FinancingActivities.Any())
                            {
                                @foreach (var item in Model.Report.FinancingActivities)
                                {
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-3 text-sm text-gray-700">@item.Description</td>
                                        <td class="px-6 py-3 text-sm font-medium text-right @(item.Amount >= 0 ? "text-green-600" : "text-red-600")">
                                            @item.Amount.ToString("C2")
                                        </td>
                                    </tr>
                                }
                            }
                            else
                            {
                                <tr>
                                    <td class="px-6 py-3 text-sm text-gray-400 italic">(No financing activities)</td>
                                    <td class="px-6 py-3 text-sm text-gray-400 text-right">$0.00</td>
                                </tr>
                            }
                            <tr class="bg-amber-100">
                                <td class="px-6 py-3 text-sm font-bold text-gray-900">Net Cash from Financing Activities</td>
                                <td class="px-6 py-3 text-sm font-bold text-right @(Model.Report.NetCashFromFinancing >= 0 ? "text-green-600" : "text-red-600")">
                                    @Model.Report.NetCashFromFinancing.ToString("C2")
                                </td>
                            </tr>
                        </tbody>

                        <!-- Summary -->
                        <thead class="bg-gray-800">
                            <tr>
                                <th colspan="2" class="px-6 py-3 text-left text-sm font-semibold text-white">
                                    <i class="bi bi-calculator mr-2"></i>SUMMARY
                                </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-3 text-sm font-bold text-gray-900">Net Change in Cash</td>
                                <td class="px-6 py-3 text-lg font-bold text-right @(Model.Report.NetChangeInCash >= 0 ? "text-green-600" : "text-red-600")">
                                    @Model.Report.NetChangeInCash.ToString("C2")
                                </td>
                            </tr>
                            <tr class="hover:bg-gray-50 border-t border-gray-100">
                                <td class="px-6 py-3 text-sm text-gray-700">Beginning Cash Balance</td>
                                <td class="px-6 py-3 text-sm text-right">@Model.Report.BeginningCashBalance.ToString("C2")</td>
                            </tr>
                            <tr class="bg-gray-800">
                                <td class="px-6 py-4 text-base font-bold text-white">Ending Cash Balance</td>
                                <td class="px-6 py-4 text-lg font-bold text-white text-right">@Model.Report.EndingCashBalance.ToString("C2")</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Charts and Metrics -->
        <div class="space-y-6">
            <!-- Cash Flow Breakdown Chart -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-semibold text-gray-900">
                        <i class="bi bi-bar-chart mr-2 text-indigo-600"></i>Cash Flow Breakdown
                    </h3>
                </div>
                <div class="p-4">
                    <canvas id="cashFlowBreakdownChart" height="250"></canvas>
                </div>
            </div>

            <!-- Key Ratios -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-semibold text-gray-900">
                        <i class="bi bi-speedometer2 mr-2 text-indigo-600"></i>Key Ratios
                    </h3>
                </div>
                <div class="p-4 space-y-5">
                    <!-- Operating CF Ratio -->
                    <div>
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm text-gray-700">Operating CF Ratio</span>
                            <span class="px-2 py-1 text-xs font-semibold rounded-full @(Model.Report.OperatingCashFlowRatio >= 1 ? "bg-green-100 text-green-800" : Model.Report.OperatingCashFlowRatio >= 0.5m ? "bg-amber-100 text-amber-800" : "bg-red-100 text-red-800")">
                                @Model.Report.OperatingCashFlowRatio.ToString("F2")
                            </span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            @{
                                var ocfProgress = Math.Min(Model.Report.OperatingCashFlowRatio * 50, 100);
                            }
                            <div class="h-2 rounded-full @(Model.Report.OperatingCashFlowRatio >= 1 ? "bg-green-500" : Model.Report.OperatingCashFlowRatio >= 0.5m ? "bg-amber-500" : "bg-red-500")"
                                 style="width: @ocfProgress%"></div>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">Operating cash flow / Current liabilities</p>
                    </div>

                    <!-- Cash Flow to Debt Ratio -->
                    <div>
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-sm text-gray-700">Cash Flow to Debt Ratio</span>
                            <span class="px-2 py-1 text-xs font-semibold rounded-full @(Model.Report.CashFlowToDebtRatio >= 0.5m ? "bg-green-100 text-green-800" : Model.Report.CashFlowToDebtRatio >= 0.25m ? "bg-amber-100 text-amber-800" : "bg-red-100 text-red-800")">
                                @Model.Report.CashFlowToDebtRatio.ToString("F2")
                            </span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2">
                            @{
                                var cftdProgress = Math.Min(Model.Report.CashFlowToDebtRatio * 100, 100);
                            }
                            <div class="h-2 rounded-full @(Model.Report.CashFlowToDebtRatio >= 0.5m ? "bg-green-500" : Model.Report.CashFlowToDebtRatio >= 0.25m ? "bg-amber-500" : "bg-red-500")"
                                 style="width: @cftdProgress%"></div>
                        </div>
                        <p class="text-xs text-gray-500 mt-1">Operating cash flow / Total debt</p>
                    </div>

                    <hr class="border-gray-200">

                    <div class="grid grid-cols-2 gap-4 text-center">
                        <div>
                            <p class="text-lg font-bold @(Model.Report.FreeCashFlow >= 0 ? "text-green-600" : "text-red-600")">
                                @Model.Report.FreeCashFlow.ToString("C0")
                            </p>
                            <p class="text-xs text-gray-500">Free Cash Flow</p>
                        </div>
                        <div>
                            <p class="text-lg font-bold text-gray-900">@Model.Report.NetIncome.ToString("C0")</p>
                            <p class="text-xs text-gray-500">Net Income</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Period Comparison -->
            @if (Model.Report.PreviousPeriod != null)
            {
                <div class="bg-white rounded-xl shadow-sm border border-gray-200">
                    <div class="px-6 py-4 border-b border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-900">
                            <i class="bi bi-arrow-left-right mr-2 text-indigo-600"></i>Period Comparison
                        </h3>
                    </div>
                    <div class="p-4">
                        <table class="w-full text-sm">
                            <thead>
                                <tr class="text-gray-500">
                                    <th class="text-left py-2"></th>
                                    <th class="text-right py-2">Current</th>
                                    <th class="text-right py-2">Previous</th>
                                    <th class="text-right py-2">Change</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y divide-gray-100">
                                <tr>
                                    <td class="py-2 text-gray-700">Operating</td>
                                    <td class="py-2 text-right">@Model.Report.NetCashFromOperating.ToString("C0")</td>
                                    <td class="py-2 text-right">@Model.Report.PreviousPeriod.NetCashFromOperating.ToString("C0")</td>
                                    <td class="py-2 text-right">
                                        @{
                                            var opChange = Model.Report.PreviousPeriod.NetCashFromOperating != 0
                                                ? ((Model.Report.NetCashFromOperating - Model.Report.PreviousPeriod.NetCashFromOperating) / Math.Abs(Model.Report.PreviousPeriod.NetCashFromOperating)) * 100
                                                : 0;
                                        }
                                        <span class="@(opChange >= 0 ? "text-green-600" : "text-red-600")">
                                            @(opChange >= 0 ? "+" : "")@opChange.ToString("F1")%
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="py-2 text-gray-700">Investing</td>
                                    <td class="py-2 text-right">@Model.Report.NetCashFromInvesting.ToString("C0")</td>
                                    <td class="py-2 text-right">@Model.Report.PreviousPeriod.NetCashFromInvesting.ToString("C0")</td>
                                    <td class="py-2 text-right">
                                        @{
                                            var invChange = Model.Report.PreviousPeriod.NetCashFromInvesting != 0
                                                ? ((Model.Report.NetCashFromInvesting - Model.Report.PreviousPeriod.NetCashFromInvesting) / Math.Abs(Model.Report.PreviousPeriod.NetCashFromInvesting)) * 100
                                                : 0;
                                        }
                                        <span class="@(invChange >= 0 ? "text-green-600" : "text-red-600")">
                                            @(invChange >= 0 ? "+" : "")@invChange.ToString("F1")%
                                        </span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="py-2 text-gray-700">Financing</td>
                                    <td class="py-2 text-right">@Model.Report.NetCashFromFinancing.ToString("C0")</td>
                                    <td class="py-2 text-right">@Model.Report.PreviousPeriod.NetCashFromFinancing.ToString("C0")</td>
                                    <td class="py-2 text-right">
                                        @{
                                            var finChange = Model.Report.PreviousPeriod.NetCashFromFinancing != 0
                                                ? ((Model.Report.NetCashFromFinancing - Model.Report.PreviousPeriod.NetCashFromFinancing) / Math.Abs(Model.Report.PreviousPeriod.NetCashFromFinancing)) * 100
                                                : 0;
                                        }
                                        <span class="@(finChange >= 0 ? "text-green-600" : "text-red-600")">
                                            @(finChange >= 0 ? "+" : "")@finChange.ToString("F1")%
                                        </span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            }
        </div>
    </div>

    <!-- Monthly Trend Chart -->
    @if (Model.Report.MonthlyTrend.Any())
    {
        <div class="bg-white rounded-xl shadow-sm border border-gray-200">
            <div class="px-6 py-4 border-b border-gray-200">
                <h2 class="text-lg font-semibold text-gray-900">
                    <i class="bi bi-graph-up mr-2 text-indigo-600"></i>Monthly Cash Flow Trend
                </h2>
            </div>
            <div class="p-4">
                <canvas id="monthlyTrendChart" height="100"></canvas>
            </div>
        </div>
    }
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Cash Flow Breakdown Chart
        const breakdownCtx = document.getElementById('cashFlowBreakdownChart').getContext('2d');
        new Chart(breakdownCtx, {
            type: 'bar',
            data: {
                labels: ['Operating', 'Investing', 'Financing', 'Net Change'],
                datasets: [{
                    data: [
                        @Model.Report.NetCashFromOperating.ToString(System.Globalization.CultureInfo.InvariantCulture),
                        @Model.Report.NetCashFromInvesting.ToString(System.Globalization.CultureInfo.InvariantCulture),
                        @Model.Report.NetCashFromFinancing.ToString(System.Globalization.CultureInfo.InvariantCulture),
                        @Model.Report.NetChangeInCash.ToString(System.Globalization.CultureInfo.InvariantCulture)
                    ],
                    backgroundColor: [
                        @(Model.Report.NetCashFromOperating >= 0 ? "'rgba(34, 197, 94, 0.8)'" : "'rgba(239, 68, 68, 0.8)'"),
                        @(Model.Report.NetCashFromInvesting >= 0 ? "'rgba(59, 130, 246, 0.8)'" : "'rgba(239, 68, 68, 0.8)'"),
                        @(Model.Report.NetCashFromFinancing >= 0 ? "'rgba(245, 158, 11, 0.8)'" : "'rgba(239, 68, 68, 0.8)'"),
                        @(Model.Report.NetChangeInCash >= 0 ? "'rgba(16, 185, 129, 0.8)'" : "'rgba(239, 68, 68, 0.8)'")
                    ],
                    borderWidth: 0,
                    borderRadius: 4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: false }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) { return '$' + value.toLocaleString(); }
                        }
                    }
                }
            }
        });

        @if (Model.Report.MonthlyTrend.Any())
        {
            <text>
        // Monthly Trend Chart
        const trendCtx = document.getElementById('monthlyTrendChart').getContext('2d');
        new Chart(trendCtx, {
            type: 'line',
            data: {
                labels: [@Html.Raw(string.Join(",", Model.Report.MonthlyTrend.Select(m => $"'{m.MonthName}'")))],
                datasets: [
                    {
                        label: 'Operating',
                        data: [@string.Join(",", Model.Report.MonthlyTrend.Select(m => m.Operating.ToString(System.Globalization.CultureInfo.InvariantCulture)))],
                        borderColor: 'rgb(34, 197, 94)',
                        backgroundColor: 'rgba(34, 197, 94, 0.1)',
                        fill: true,
                        tension: 0.4
                    },
                    {
                        label: 'Investing',
                        data: [@string.Join(",", Model.Report.MonthlyTrend.Select(m => m.Investing.ToString(System.Globalization.CultureInfo.InvariantCulture)))],
                        borderColor: 'rgb(59, 130, 246)',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        fill: true,
                        tension: 0.4
                    },
                    {
                        label: 'Financing',
                        data: [@string.Join(",", Model.Report.MonthlyTrend.Select(m => m.Financing.ToString(System.Globalization.CultureInfo.InvariantCulture)))],
                        borderColor: 'rgb(245, 158, 11)',
                        backgroundColor: 'rgba(245, 158, 11, 0.1)',
                        fill: true,
                        tension: 0.4
                    },
                    {
                        label: 'Net Change',
                        data: [@string.Join(",", Model.Report.MonthlyTrend.Select(m => m.NetChange.ToString(System.Globalization.CultureInfo.InvariantCulture)))],
                        borderColor: 'rgb(139, 92, 246)',
                        borderWidth: 3,
                        borderDash: [5, 5],
                        fill: false,
                        tension: 0.4
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { position: 'top' }
                },
                scales: {
                    y: {
                        ticks: {
                            callback: function(value) { return '$' + value.toLocaleString(); }
                        }
                    }
                }
            }
        });
            </text>
        }
    </script>
}
