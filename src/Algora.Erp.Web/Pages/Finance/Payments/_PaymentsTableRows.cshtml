@model Algora.Erp.Web.Pages.Finance.Payments.IndexModel
@using Algora.Erp.Domain.Entities.Finance

@if (Model.PaymentResult.Payments.Any())
{
    foreach (var payment in Model.PaymentResult.Payments)
    {
        var methodBadgeClass = payment.PaymentMethod switch
        {
            PaymentMethod.Cash => "bg-success",
            PaymentMethod.BankTransfer => "bg-primary",
            PaymentMethod.CreditCard => "bg-info",
            PaymentMethod.DebitCard => "bg-info",
            PaymentMethod.Check => "bg-warning text-dark",
            PaymentMethod.PayPal => "bg-primary",
            _ => "bg-secondary"
        };

        <tr>
            <td class="ps-4">
                <a href="/Finance/Payments/Details/@payment.Id" class="text-decoration-none fw-medium">
                    @payment.PaymentNumber
                </a>
            </td>
            <td>@payment.PaymentDate.ToString("MMM dd, yyyy")</td>
            <td>
                <a href="/Finance/Invoices/Details/@payment.InvoiceId" class="text-decoration-none">
                    @payment.InvoiceNumber
                </a>
                <br />
                <small class="text-muted">Total: @payment.InvoiceTotal.ToString("C2")</small>
            </td>
            <td>
                @if (!string.IsNullOrEmpty(payment.CustomerName))
                {
                    <a href="/Sales/Customers/Details/@payment.CustomerId" class="text-decoration-none">
                        @payment.CustomerName
                    </a>
                }
                else
                {
                    <span class="text-muted">-</span>
                }
            </td>
            <td>
                <span class="badge @methodBadgeClass">@payment.PaymentMethod</span>
            </td>
            <td>
                @if (!string.IsNullOrEmpty(payment.Reference))
                {
                    <span class="text-muted">@payment.Reference</span>
                }
                else
                {
                    <span class="text-muted">-</span>
                }
            </td>
            <td class="text-end fw-medium text-success">@payment.Amount.ToString("C2")</td>
            <td class="text-end pe-4">
                <div class="dropdown">
                    <button class="btn btn-sm btn-outline-secondary" id="dropdownPay@(payment.Id)" data-dropdown-toggle="dropdownMenuPay@(payment.Id)">
                        <i class="bi bi-three-dots"></i>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end" id="dropdownMenuPay@(payment.Id)">
                        <li>
                            <a class="dropdown-item" href="/Finance/Payments/Details/@payment.Id">
                                <i class="bi bi-eye me-2"></i>View Details
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="/Finance/Payments/Receipt/@payment.Id" target="_blank">
                                <i class="bi bi-receipt me-2"></i>Print Receipt
                            </a>
                        </li>
                        <li>
                            <a class="dropdown-item" href="/Finance/Invoices/Details/@payment.InvoiceId">
                                <i class="bi bi-file-text me-2"></i>View Invoice
                            </a>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li>
                            <form method="post" asp-page-handler="Delete" asp-route-paymentId="@payment.Id">
                                <button type="submit" class="dropdown-item text-danger"
                                        onclick="return confirm('Delete this payment? This will restore the invoice balance.')">
                                    <i class="bi bi-trash me-2"></i>Delete Payment
                                </button>
                            </form>
                        </li>
                    </ul>
                </div>
            </td>
        </tr>
    }
}
else
{
    <tr>
        <td colspan="8" class="text-center py-5 text-muted">
            <i class="bi bi-cash-stack fs-1 d-block mb-3"></i>
            <p class="mb-0">No payments found</p>
            @if (!string.IsNullOrEmpty(Model.SearchTerm) || Model.PaymentMethod.HasValue || Model.FromDate.HasValue || Model.ToDate.HasValue)
            {
                <p class="mb-0"><small>Try adjusting your filters</small></p>
            }
        </td>
    </tr>
}
