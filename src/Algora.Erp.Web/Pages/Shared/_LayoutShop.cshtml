@using Microsoft.AspNetCore.Http
@inject IHttpContextAccessor HttpContextAccessor
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Algora Shop</title>

    <!-- Tailwind CSS Play CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Flowbite CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.1/flowbite.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: {
                            50: '#eef2ff',
                            100: '#e0e7ff',
                            200: '#c7d2fe',
                            300: '#a5b4fc',
                            400: '#818cf8',
                            500: '#6366f1',
                            600: '#4f46e5',
                            700: '#4338ca',
                            800: '#3730a3',
                            900: '#312e81',
                            950: '#1e1b4b'
                        }
                    }
                }
            }
        }
    </script>

    <style>
        [x-cloak] { display: none !important; }

        /* HTMX loading indicator */
        .htmx-indicator { display: none; }
        .htmx-request .htmx-indicator { display: inline-block; }
    </style>
</head>
<body class="bg-white font-sans">
    <!-- Header -->
    <header class="bg-white border-b border-gray-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-4">
                <!-- Logo -->
                <a href="/Shop" class="flex items-center text-xl font-bold text-primary-600 hover:text-primary-700">
                    <i class="bi bi-box-seam me-2"></i>Algora Shop
                </a>

                <!-- Desktop Navigation -->
                <nav class="hidden md:flex items-center gap-1">
                    <a href="/Shop" class="px-4 py-2 text-gray-700 font-medium hover:text-primary-600 rounded-lg transition-colors">Shop</a>
                    <a href="/Shop/Categories" class="px-4 py-2 text-gray-700 font-medium hover:text-primary-600 rounded-lg transition-colors">Categories</a>
                    <a href="/Shop/Deals" class="px-4 py-2 text-gray-700 font-medium hover:text-primary-600 rounded-lg transition-colors">Deals</a>
                    <a href="/Shop/About" class="px-4 py-2 text-gray-700 font-medium hover:text-primary-600 rounded-lg transition-colors">About</a>
                </nav>

                <!-- Right Actions -->
                <div class="flex items-center gap-3">
                    <!-- Search -->
                    <div class="hidden lg:block">
                        <div class="relative">
                            <div class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none">
                                <i class="bi bi-search text-gray-400"></i>
                            </div>
                            <input type="search"
                                   class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-48 ps-10 p-2.5"
                                   placeholder="Search products...">
                        </div>
                    </div>

                    <!-- Account -->
                    <a href="/Shop/Account" class="p-2 text-gray-600 hover:text-primary-600 transition-colors">
                        <i class="bi bi-person text-xl"></i>
                    </a>

                    <!-- Cart -->
                    <a href="/Shop/Cart" class="relative p-2 text-gray-600 hover:text-primary-600 transition-colors">
                        <i class="bi bi-bag text-xl"></i>
                        <span id="cartCount" class="absolute -top-1 -right-1 inline-flex items-center justify-center w-5 h-5 text-xs font-bold text-white bg-primary-600 rounded-full">0</span>
                    </a>

                    <!-- Mobile Menu Button -->
                    <button type="button" class="md:hidden p-2 text-gray-600 hover:text-primary-600"
                            data-drawer-target="mobileMenu" data-drawer-toggle="mobileMenu">
                        <i class="bi bi-list text-2xl"></i>
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Mobile Menu Drawer -->
    <div id="mobileMenu" class="fixed top-0 right-0 z-50 h-screen p-4 overflow-y-auto transition-transform translate-x-full bg-white w-80" tabindex="-1" aria-labelledby="drawer-right-label">
        <div class="flex justify-between items-center mb-4">
            <h5 id="drawer-right-label" class="text-lg font-semibold text-gray-900">Menu</h5>
            <button type="button" data-drawer-hide="mobileMenu" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm p-1.5">
                <i class="bi bi-x-lg"></i>
            </button>
        </div>
        <nav class="space-y-2">
            <a href="/Shop" class="block px-4 py-3 text-gray-700 font-medium hover:bg-gray-100 rounded-lg">Shop</a>
            <a href="/Shop/Categories" class="block px-4 py-3 text-gray-700 font-medium hover:bg-gray-100 rounded-lg">Categories</a>
            <a href="/Shop/Deals" class="block px-4 py-3 text-gray-700 font-medium hover:bg-gray-100 rounded-lg">Deals</a>
            <a href="/Shop/About" class="block px-4 py-3 text-gray-700 font-medium hover:bg-gray-100 rounded-lg">About</a>
            <hr class="my-4 border-gray-200">
            <a href="/Shop/Account" class="block px-4 py-3 text-gray-700 font-medium hover:bg-gray-100 rounded-lg">My Account</a>
            <a href="/Shop/Cart" class="block px-4 py-3 text-gray-700 font-medium hover:bg-gray-100 rounded-lg">Cart</a>
        </nav>
        <div class="mt-4">
            <div class="relative">
                <div class="absolute inset-y-0 start-0 flex items-center ps-3 pointer-events-none">
                    <i class="bi bi-search text-gray-400"></i>
                </div>
                <input type="search"
                       class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-500 focus:border-primary-500 block w-full ps-10 p-2.5"
                       placeholder="Search products...">
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="min-h-screen">
        @RenderBody()
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 text-gray-400 mt-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-8">
                <!-- Brand -->
                <div class="lg:col-span-1">
                    <h6 class="flex items-center text-white font-bold text-lg mb-4">
                        <i class="bi bi-box-seam me-2"></i>Algora Shop
                    </h6>
                    <p class="text-sm mb-4">Your one-stop shop for quality products at great prices.</p>
                    <div class="flex gap-4">
                        <a href="#" class="text-gray-400 hover:text-white transition-colors"><i class="bi bi-facebook text-xl"></i></a>
                        <a href="#" class="text-gray-400 hover:text-white transition-colors"><i class="bi bi-twitter-x text-xl"></i></a>
                        <a href="#" class="text-gray-400 hover:text-white transition-colors"><i class="bi bi-instagram text-xl"></i></a>
                    </div>
                </div>

                <!-- Shop Links -->
                <div>
                    <h6 class="text-white font-semibold mb-4">Shop</h6>
                    <ul class="space-y-2 text-sm">
                        <li><a href="/Shop" class="hover:text-white transition-colors">All Products</a></li>
                        <li><a href="/Shop/Categories" class="hover:text-white transition-colors">Categories</a></li>
                        <li><a href="/Shop/Deals" class="hover:text-white transition-colors">Deals</a></li>
                        <li><a href="/Shop?new=true" class="hover:text-white transition-colors">New Arrivals</a></li>
                    </ul>
                </div>

                <!-- Account Links -->
                <div>
                    <h6 class="text-white font-semibold mb-4">Account</h6>
                    <ul class="space-y-2 text-sm">
                        <li><a href="/Shop/Account" class="hover:text-white transition-colors">My Account</a></li>
                        <li><a href="/Shop/Account/Orders" class="hover:text-white transition-colors">Orders</a></li>
                        <li><a href="/Shop/Account/Wishlist" class="hover:text-white transition-colors">Wishlist</a></li>
                        <li><a href="/Shop/Cart" class="hover:text-white transition-colors">Cart</a></li>
                    </ul>
                </div>

                <!-- Support Links -->
                <div>
                    <h6 class="text-white font-semibold mb-4">Support</h6>
                    <ul class="space-y-2 text-sm">
                        <li><a href="/Shop/Contact" class="hover:text-white transition-colors">Contact Us</a></li>
                        <li><a href="/Shop/FAQ" class="hover:text-white transition-colors">FAQ</a></li>
                        <li><a href="/Shop/Shipping" class="hover:text-white transition-colors">Shipping</a></li>
                        <li><a href="/Shop/Returns" class="hover:text-white transition-colors">Returns</a></li>
                    </ul>
                </div>

                <!-- Legal Links -->
                <div>
                    <h6 class="text-white font-semibold mb-4">Legal</h6>
                    <ul class="space-y-2 text-sm">
                        <li><a href="/Shop/Privacy" class="hover:text-white transition-colors">Privacy Policy</a></li>
                        <li><a href="/Shop/Terms" class="hover:text-white transition-colors">Terms of Service</a></li>
                    </ul>
                </div>
            </div>

            <hr class="my-8 border-gray-700">

            <div class="text-center text-sm">
                <p>&copy; @DateTime.Now.Year Algora Shop. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Flowbite JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.2.1/flowbite.min.js"></script>
    <!-- HTMX -->
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <!-- Custom JS -->
    <script src="~/js/shop.js" asp-append-version="true"></script>

    <script>
        // Cart functionality
        function updateCartCount() {
            const cart = JSON.parse(localStorage.getItem('cart') || '[]');
            const count = cart.reduce((sum, item) => sum + item.quantity, 0);
            document.getElementById('cartCount').textContent = count;
        }

        function addToCart(productId, name, price, image) {
            const cart = JSON.parse(localStorage.getItem('cart') || '[]');
            const existing = cart.find(item => item.productId === productId);

            if (existing) {
                existing.quantity++;
            } else {
                cart.push({ productId, name, price, image, quantity: 1 });
            }

            localStorage.setItem('cart', JSON.stringify(cart));
            updateCartCount();

            // Show toast
            const toast = document.getElementById('cartToast');
            toast.classList.remove('hidden');
            toast.classList.add('flex');
            setTimeout(() => {
                toast.classList.add('hidden');
                toast.classList.remove('flex');
            }, 3000);
        }

        // Initialize cart count on page load
        document.addEventListener('DOMContentLoaded', updateCartCount);
    </script>

    <!-- Cart Toast -->
    <div id="cartToast" class="hidden fixed bottom-4 right-4 items-center p-4 text-gray-500 bg-white rounded-lg shadow-lg border border-gray-200 z-50" role="alert">
        <div class="inline-flex items-center justify-center flex-shrink-0 w-8 h-8 text-emerald-500 bg-emerald-100 rounded-lg">
            <i class="bi bi-check-circle-fill"></i>
        </div>
        <div class="ms-3">
            <div class="text-sm font-medium text-gray-900">Added to Cart</div>
            <div class="text-sm text-gray-500">Item has been added to your cart.</div>
        </div>
        <a href="/Shop/Cart" class="ms-4 text-sm font-medium text-primary-600 hover:text-primary-700">View Cart</a>
        <button type="button" class="ms-2 -mx-1.5 -my-1.5 bg-white text-gray-400 hover:text-gray-900 rounded-lg p-1.5" onclick="this.parentElement.classList.add('hidden'); this.parentElement.classList.remove('flex');">
            <i class="bi bi-x-lg"></i>
        </button>
    </div>

    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
